import ModuleHeader from "@/components/markdown/ModuleHeader.astro";

{/* lint disable no-duplicate-headings */}

{/* eslint-disable import/order */}

<ModuleHeader name="kube_argo" sourceHref="https://github.com/Panfactum/stack/tree/__PANFACTUM_VERSION_STABLE_25_04__/packages/infrastructure/kube_argo" status="beta" type="direct" />

# Argo Workflows

## Providers

The following providers are needed by this module:

* [helm](https://registry.terraform.io/providers/hashicorp/helm/2.12.1/docs) (2.12.1)

* [kubectl](https://registry.terraform.io/providers/alekc/kubectl/2.1.3/docs) (2.1.3)

* [kubernetes](https://registry.terraform.io/providers/hashicorp/kubernetes/2.34.0/docs) (2.34.0)

* [pf](https://registry.terraform.io/providers/panfactum/pf/0.0.7/docs) (0.0.7)

* [random](https://registry.terraform.io/providers/hashicorp/random/3.6.3/docs) (3.6.3)

* [time](https://registry.terraform.io/providers/hashicorp/time/0.10.0/docs) (0.10.0)

* [vault](https://registry.terraform.io/providers/hashicorp/vault/4.5.0/docs) (4.5.0)

## Required Inputs

The following input variables are required:

### argo\_domain

Description: The domain to use for the argo UI. Must be in a subdomain available to the environment.

Type: `string`

### vault\_domain

Description: The domain of the Vault instance running in the cluster.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### argo\_events\_helm\_version

Description: The version of the argo events helm chart to deploy

Type: `string`

Default: `"2.4.9"`

### argo\_workflows\_helm\_version

Description: The version of the argo workflows helm chart to deploy

Type: `string`

Default: `"0.45.1"`

### aws\_iam\_ip\_allow\_list

Description: A list of IPs that can use the service account token to authenticate with AWS API

Type: `list(string)`

Default: `[]`

### burstable\_nodes\_enabled

Description: Whether to allow pods to schedule on burstable nodes

Type: `bool`

Default: `true`

### controller\_nodes\_enabled

Description: Whether to allow pods to schedule on EKS Node Group nodes (controller nodes)

Type: `bool`

Default: `true`

### db\_backup\_directory

Description: The name of the directory in the backup bucket containing the backups files for the database.

Type: `string`

Default: `"initial"`

### db\_recovery\_directory

Description: The name of the directory in the backup bucket that contains the PostgreSQL backups and WAL archives

Type: `string`

Default: `null`

### db\_recovery\_mode\_enabled

Description: Whether to enable recovery mode for the PostgreSQL database

Type: `bool`

Default: `false`

### db\_recovery\_target\_time

Description: If provided, will recover the PostgreSQL database to the indicated target time in RFC 3339 format rather than to the latest data.

Type: `string`

Default: `null`

### ingress\_enabled

Description: Whether or not to enable the ingress for routing traffic to argo

Type: `bool`

Default: `true`

### log\_level

Description: The log level for the argo pods

Type: `string`

Default: `"info"`

### monitoring\_enabled

Description: Whether to add active monitoring to the deployed systems

Type: `bool`

Default: `false`

### panfactum\_scheduler\_enabled

Description: Whether to use the Panfactum pod scheduler with enhanced bin-packing

Type: `bool`

Default: `false`

### pg\_maximum\_cpu\_millicores

Description: The maximum amount of cpu to allocate to the postgres pods (in millicores)

Type: `number`

Default: `10000`

### pg\_maximum\_memory\_mb

Description: The maximum amount of memory to allocate to the postgres pods (in Mi)

Type: `number`

Default: `128000`

### pg\_minimum\_cpu\_millicores

Description: The minimum amount of cpu to allocate to the postgres pods (in millicores)

Type: `number`

Default: `50`

### pg\_minimum\_cpu\_update\_millicores

Description: The CPU settings for the Postgres won't be updated until the recommendations from the VPA (if enabled) differ from the current settings by at least this many millicores. This prevents autoscaling thrash.

Type: `number`

Default: `250`

### pg\_minimum\_memory\_mb

Description: The minimum amount of memory to allocate to the postgres pods (in Mi)

Type: `number`

Default: `500`

### pgbouncer\_maximum\_cpu\_millicores

Description: The maximum amount of cpu to allocate to the pgbouncer pods (in millicores)

Type: `number`

Default: `10000`

### pgbouncer\_maximum\_memory\_mb

Description: The maximum amount of memory to allocate to the pgbouncer pods (in Mi)

Type: `number`

Default: `32000`

### pgbouncer\_minimum\_cpu\_millicores

Description: The minimum amount of cpu to allocate to the pgbouncer pods (in millicores)

Type: `number`

Default: `15`

### pgbouncer\_minimum\_memory\_mb

Description: The minimum amount of memory to allocate to the pgbouncer pods (in Mi)

Type: `number`

Default: `25`

### pull\_through\_cache\_enabled

Description: Whether to use the ECR pull through cache for the deployed images

Type: `bool`

Default: `true`

### sla\_target

Description: The Panfactum SLA level for the module deployment. 1 = lowest uptime (99.9%), lowest cost -- 3 = highest uptime (99.999%), highest Cost

Type: `number`

Default: `3`

### spot\_nodes\_enabled

Description: Whether to allow pods to schedule on spot nodes

Type: `bool`

Default: `true`

### test\_workflow\_enabled

Description: Whether to enable the test WorkflowTemplate

Type: `bool`

Default: `false`

### vpa\_enabled

Description: Whether the VPA resources should be enabled

Type: `bool`

Default: `true`

### wait

Description: Wait for resources to be in a ready state before proceeding. Disabling this flag will allow upgrades to proceed faster but will disable automatic rollbacks. As a result, manual intervention may be required for deployment failures.

Type: `bool`

Default: `true`

### workflow\_archive\_ttl

Description: Length of time that previously run workflow states are stored

Type: `string`

Default: `"60d"`

## Outputs

The following outputs are exported:

### artifact\_bucket\_arn

Description: ARN of the S3 bucket holding workflow artifacts

### artifact\_bucket\_name

Description: Name of the S3 bucket holding workflow artifacts

### db\_backup\_bucket

Description: The name of the S3 bucket that contains the PostgreSQL backups and WAL archives

### db\_backup\_directory

Description: The name of the directory in the backup bucket that contains the PostgreSQL backups and WAL archives

## Usage

No notes

{/* eslint-enable import/order */}

{/* lint enable no-duplicate-headings */}
