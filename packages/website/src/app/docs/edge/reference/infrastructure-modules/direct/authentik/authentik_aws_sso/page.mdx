import ModuleHeader from "../../../ModuleHeader";

{/* lint disable no-duplicate-headings */}

{/* eslint-disable import/order */}

<ModuleHeader name="authentik_aws_sso" sourceHref="https://github.com/Panfactum/stack/tree/__PANFACTUM_VERSION_EDGE__/packages/infrastructure/authentik_aws_sso" status="stable" type="direct" />

# AWS SSO with Authentik

## Providers

The following providers are needed by this module:

* [authentik](https://registry.terraform.io/providers/goauthentik/authentik/2024.8.4/docs) (2024.8.4)

* [kubectl](https://registry.terraform.io/providers/alekc/kubectl/2.1.3/docs) (2.1.3)

* [kubernetes](https://registry.terraform.io/providers/hashicorp/kubernetes/2.34.0/docs) (2.34.0)

* [random](https://registry.terraform.io/providers/hashicorp/random/3.6.3/docs) (3.6.3)

* [tls](https://registry.terraform.io/providers/hashicorp/tls/4.0.6/docs) (4.0.6)

## Required Inputs

The following input variables are required:

### authentik\_domain

Description: The domain name of the authentik instance

Type: `string`

### authentik\_namespace

Description: The kubernetes namespace where Authentik is deployed

Type: `string`

### aws\_acs\_url

Description: The ACS url provided by AWS when configuring an external identity provider

Type: `string`

### aws\_issuer

Description: The Issuer url provided by AWS when configuring an external identity provider

Type: `string`

### aws\_sign\_in\_url

Description: The sign-in url provided by AWS when configuring an external identity provider

Type: `string`

### media\_configmap

Description: The configmap holding the static media that Authentik will use

Type: `string`

### organization\_name

Description: The name of your organization

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### allowed\_groups

Description: Only members of these groups can access AWS

Type: `set(string)`

Default: `[]`

### aws\_scim\_enabled

Description: Whether to enable SCIM with AWS

Type: `bool`

Default: `false`

### aws\_scim\_token

Description: The SCIM token provided by AWS

Type: `string`

Default: `""`

### aws\_scim\_url

Description: The SCIM endpoint provided by AWS

Type: `string`

Default: `""`

### ui\_description

Description: The description to display in the Authentik web dashboard

Type: `string`

Default: `"Amazon Web Services - IAM Identity Center SSO Login"`

### ui\_group

Description: The section in the Authentik web dashboard that this will appear in

Type: `string`

Default: `"Amazon Web Services"`

## Outputs

The following outputs are exported:

### saml\_metadata

Description: n/a

## Usage

1. You have to enable AWS SSO in the root account via the web console
   before applying this module for the first time.

2. The SAML metadata document from the IdP needs to be uploaded to AWS MANUALLY.

3. SCIM provisioning must be configured MANUALLY. Group assignments won't work until this step is completed.

4. The user portal URL needs to be configured MANUALLY in the aws web console in the SSO settings.

{/* eslint-enable import/order */}

{/* lint enable no-duplicate-headings */}
