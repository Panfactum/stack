import ModuleHeader from "../../../ModuleHeader";

{/* lint disable no-duplicate-headings */}

{/* eslint-disable import/order */}

<ModuleHeader name="authentik_vault_sso" sourceHref="https://github.com/Panfactum/stack/tree/__PANFACTUM_VERSION_MAIN__/packages/infrastructure/authentik_vault_sso" status="stable" type="direct" />

# AWS SSO with Authentik

## Providers

The following providers are needed by this module:

* [authentik](https://registry.terraform.io/providers/goauthentik/authentik/2024.2.0/docs) (2024.2.0)

* [kubectl](https://registry.terraform.io/providers/alekc/kubectl/2.0.4/docs) (2.0.4)

* [kubernetes](https://registry.terraform.io/providers/hashicorp/kubernetes/2.27.0/docs) (2.27.0)

* [random](https://registry.terraform.io/providers/hashicorp/random/3.6.0/docs) (3.6.0)

* [tls](https://registry.terraform.io/providers/hashicorp/tls/4.0.5/docs) (4.0.5)

## Required Inputs

The following input variables are required:

### authentik\_domain

Description: The domain name of the authentik instance

Type: `string`

### authentik\_namespace

Description: The kubernetes namespace where Authentik is deployed

Type: `string`

### media\_configmap

Description: The configmap holding the static media that Authentik will use

Type: `string`

### organization\_name

Description: The name of your organization

Type: `string`

### vault\_domain

Description: The domain name of the Vault instance

Type: `string`

### vault\_name

Description: The name of the vault instance. Must be unique in the Authentik system.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### allowed\_groups

Description: Only members of these groups can access AWS

Type: `set(string)`

Default: `[]`

### ui\_description

Description: The description to display in the Authentik web dashboard

Type: `string`

Default: `"A Hashicorp Vault cluster"`

### ui\_group

Description: The section in the Authentik web dashboard that this will appear in

Type: `string`

Default: `"Vault"`

## Outputs

The following outputs are exported:

### client\_id

Description: The client ID to provide to the auth/oidc auth method in Vault

### client\_secret

Description: The client secret to provide the auth/oidc auth method in Vault

### oidc\_discovery\_url

Description: The OIDC discovery url to use for the auth/oidc auth method in Vault

### oidc\_issuer

Description: The issuer to use for the auth/oidc auth method in Vault

### oidc\_redirect\_uris

Description: The redirect URIs to use for the auth/oidc auth method in Vault

## Usage

1. You have to enable AWS SSO in the root account via the web console
   before applying this module for the first time.

2. The SAML metadata document from the IdP needs to be uploaded to AWS MANUALLY.

3. SCIM provisioning must be configured MANUALLY. Group assignments won't work until this step is completed.

4. The user portal URL needs to be configured MANUALLY in the aws web console in the SSO settings.

{/* eslint-enable import/order */}

{/* lint enable no-duplicate-headings */}
