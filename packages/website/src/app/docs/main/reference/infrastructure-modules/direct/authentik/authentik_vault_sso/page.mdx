import ModuleHeader from "../../../ModuleHeader";

{/* lint disable no-duplicate-headings */}

# AWS SSO with Authentik

<ModuleHeader name="authentik_vault_sso" sourceHref="https://github.com/Panfactum/stack/tree/__PANFACTUM_VERSION_MAIN__/packages/infrastructure/authentik_vault_sso" status="stable" type="direct" />

## Providers

The following providers are needed by this module:

* [authentik](https://registry.terraform.io/providers/hashicorp/authentik/2024.2.0/docs) (2024.2.0)

* [kubectl](#requirement_kubectl) (2.0.4)

* [kubernetes](https://registry.terraform.io/providers/hashicorp/kubernetes/2.27.0/docs) (2.27.0)

* [random](https://registry.terraform.io/providers/hashicorp/random/3.6.0/docs) (3.6.0)

* [tls](#requirement_tls) (4.0.5)

## Required Inputs

The following input variables are required:

### <a name="input_authentik_domain" /> [authentik\_domain](#input_authentik_domain)

Description: The domain name of the authentik instance

Type: `string`

### <a name="input_authentik_namespace" /> [authentik\_namespace](#input_authentik_namespace)

Description: The kubernetes namespace where Authentik is deployed

Type: `string`

### <a name="input_media_configmap" /> [media\_configmap](#input_media_configmap)

Description: The configmap holding the static media that Authentik will use

Type: `string`

### <a name="input_organization_name" /> [organization\_name](#input_organization_name)

Description: The name of your organization

Type: `string`

### <a name="input_vault_domain" /> [vault\_domain](#input_vault_domain)

Description: The domain name of the Vault instance

Type: `string`

### <a name="input_vault_name" /> [vault\_name](#input_vault_name)

Description: The name of the vault instance. Must be unique in the Authentik system.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_allowed_groups" /> [allowed\_groups](#input_allowed_groups)

Description: Only members of these groups can access AWS

Type: `set(string)`

Default: `[]`

### <a name="input_ui_description" /> [ui\_description](#input_ui_description)

Description: The description to display in the Authentik web dashboard

Type: `string`

Default: `"A Hashicorp Vault cluster"`

### <a name="input_ui_group" /> [ui\_group](#input_ui_group)

Description: The section in the Authentik web dashboard that this will appear in

Type: `string`

Default: `"Vault"`

## Outputs

The following outputs are exported:

### <a name="output_client_id" /> [client\_id](#output_client_id)

Description: The client ID to provide to the auth/oidc auth method in Vault

### <a name="output_client_secret" /> [client\_secret](#output_client_secret)

Description: The client secret to provide the auth/oidc auth method in Vault

### <a name="output_oidc_discovery_url" /> [oidc\_discovery\_url](#output_oidc_discovery_url)

Description: The OIDC discovery url to use for the auth/oidc auth method in Vault

### <a name="output_oidc_issuer" /> [oidc\_issuer](#output_oidc_issuer)

Description: The issuer to use for the auth/oidc auth method in Vault

### <a name="output_oidc_redirect_uris" /> [oidc\_redirect\_uris](#output_oidc_redirect_uris)

Description: The redirect URIs to use for the auth/oidc auth method in Vault

## Usage

1. You have to enable AWS SSO in the root account via the web console
   before applying this module for the first time.

2. The SAML metadata document from the IdP needs to be uploaded to AWS MANUALLY.

3. SCIM provisioning must be configured MANUALLY. Group assignments won't work until this step is completed.

4. The user portal URL needs to be configured MANUALLY in the aws web console in the SSO settings.

{/* lint enable no-duplicate-headings */}
