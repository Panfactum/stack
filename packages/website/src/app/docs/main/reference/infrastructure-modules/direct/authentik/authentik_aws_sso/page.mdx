import ModuleHeader from "../../../ModuleHeader";

{/* lint disable no-duplicate-headings */}

# AWS SSO with Authentik
<ModuleHeader name="authentik_aws_sso" sourceHref="https://github.com/Panfactum/stack/tree/__PANFACTUM_VERSION_MAIN__/packages/infrastructure/authentik_aws_sso" status="stable" type="direct"/>

## Providers

The following providers are needed by this module:

-  [authentik](https://registry.terraform.io/providers/hashicorp/authentik/2024.2.0/docs) (2024.2.0)

-  [kubectl](#requirement\_kubectl) (2.0.4)

-  [kubernetes](https://registry.terraform.io/providers/hashicorp/kubernetes/2.27.0/docs) (2.27.0)

-  [random](https://registry.terraform.io/providers/hashicorp/random/3.6.0/docs) (3.6.0)

-  [tls](#requirement\_tls) (4.0.5)

## Required Inputs

The following input variables are required:

### <a name="input_authentik_domain"></a> [authentik\_domain](#input\_authentik\_domain)

Description: The domain name of the authentik instance

Type: `string`

### <a name="input_authentik_namespace"></a> [authentik\_namespace](#input\_authentik\_namespace)

Description: The kubernetes namespace where Authentik is deployed

Type: `string`

### <a name="input_aws_acs_url"></a> [aws\_acs\_url](#input\_aws\_acs\_url)

Description: The ACS url provided by AWS when configuring an external identity provider

Type: `string`

### <a name="input_aws_issuer"></a> [aws\_issuer](#input\_aws\_issuer)

Description: The Issuer url provided by AWS when configuring an external identity provider

Type: `string`

### <a name="input_aws_sign_in_url"></a> [aws\_sign\_in\_url](#input\_aws\_sign\_in\_url)

Description: The sign-in url provided by AWS when configuring an external identity provider

Type: `string`

### <a name="input_media_configmap"></a> [media\_configmap](#input\_media\_configmap)

Description: The configmap holding the static media that Authentik will use

Type: `string`

### <a name="input_organization_name"></a> [organization\_name](#input\_organization\_name)

Description: The name of your organization

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_allowed_groups"></a> [allowed\_groups](#input\_allowed\_groups)

Description: Only members of these groups can access AWS

Type: `set(string)`

Default: `[]`

### <a name="input_aws_scim_enabled"></a> [aws\_scim\_enabled](#input\_aws\_scim\_enabled)

Description: Whether to enable SCIM with AWS

Type: `bool`

Default: `false`

### <a name="input_aws_scim_token"></a> [aws\_scim\_token](#input\_aws\_scim\_token)

Description: The SCIM token provided by AWS

Type: `string`

Default: `""`

### <a name="input_aws_scim_url"></a> [aws\_scim\_url](#input\_aws\_scim\_url)

Description: The SCIM endpoint provided by AWS

Type: `string`

Default: `""`









### <a name="input_ui_description"></a> [ui\_description](#input\_ui\_description)

Description: The description to display in the Authentik web dashboard

Type: `string`

Default: `"Amazon Web Services - IAM Identity Center SSO Login"`

### <a name="input_ui_group"></a> [ui\_group](#input\_ui\_group)

Description: The section in the Authentik web dashboard that this will appear in

Type: `string`

Default: `"Amazon Web Services"`

## Outputs

The following outputs are exported:

### <a name="output_saml_metadata"></a> [saml\_metadata](#output\_saml\_metadata)

Description: n/a

## Usage

1. You have to enable AWS SSO in the root account via the web console
   before applying this module for the first time.

2. The SAML metadata document from the IdP needs to be uploaded to AWS MANUALLY.

3. SCIM provisioning must be configured MANUALLY. Group assignments won't work until this step is completed.

4. The user portal URL needs to be configured MANUALLY in the aws web console in the SSO settings.

{/* lint enable no-duplicate-headings */}
